
---

# **üõ°Ô∏è NoSQL Injection (MongoDB) ‚Äì Bypass Authentication Using Operators**

## **üí° Quick Overview**

1. **Attack Overview**: Exploit a **NoSQL injection** vulnerability in MongoDB to bypass authentication and log in as the `administrator`.
    - **Key Operators**: Use `$ne` (`not equal`) to bypass checks and `$regex` (regex matching) to target specific users like `admin`.
    - Example Payload:
        
        ```json
        "username": { "$regex": "admin.*" },
        "password": { "$ne": "" }
        ```
        
2. **Solution Workflow**:
    - **Step 1**: Send a valid login request to **Burp Repeater**.
    - **Step 2**: Replace the username and password fields with injection payloads.
    - **Step 3**: Identify successful login attempts by looking for a **302 Found** response.
    - **Step 4**: Copy the `Set-Cookie` header from the response and use it to log in as the admin.
3. **Key Takeaway**:
    - **NoSQL Injection** allows attackers to manipulate JSON-based queries using operators like `$ne` and `$regex` to match unintended records.
    - MongoDB's flexible query structure makes it vulnerable when input sanitization is weak.
    
**_the password doesn't need to match the actual admin password because the injection payload `{ "$ne": "" }` tells the database to return any record where the password is **not empty**. The query effectively bypasses password verification by exploiting weak input validation, allowing unauthorized access as long as the condition is met.

---

## **üõ†Ô∏è Lab Goal**

- **Objective**: Exploit a NoSQL injection vulnerability to bypass authentication and log in as the `administrator`.

---

## **üöÄ Solution Summary**

### **1Ô∏è‚É£ Initial Setup**

- Log in as `wiener:peter` to capture the `POST /login` request in **Burp Suite**.
- Send the request to **Repeater** for modification.

### **2Ô∏è‚É£ Testing Basic NoSQL Injection**

- Replace the `username` with `{ "$ne": "" }` and keep `password` as `peter`.
    
    ```json
    "username": { "$ne": "" },
    "password": "peter"
    ```
    
- Send the request and look for a **302 Found** response, indicating a bypass.

### **3Ô∏è‚É£ Refine the Injection**

- Replace the `username` with a regex pattern to match admin users:
    
    ```json
    "username": { "$regex": "admin.*" },
    "password": { "$ne": "" }
    ```
    
- Send the request. A **302 Found** response confirms successful login as `administrator`.

### **4Ô∏è‚É£ Use the Admin Session Cookie**

- Copy the `Set-Cookie` header from the successful response.
- Replace your session cookie in the browser with this new cookie.
- Refresh the page to confirm admin access.

---

## **üìå Key Takeaways**

### **1Ô∏è‚É£ Operators for NoSQL Injection**

- **`$ne`**: Matches all records where the field is **not equal** to the specified value.
- **`$regex`**: Matches fields based on a regular expression pattern.

### **2Ô∏è‚É£ Exploiting NoSQL Authentication**

- Use `$ne` to bypass login checks for both username and password.
- Use `$regex` to target specific users like `administrator`.

### **3Ô∏è‚É£ Security Best Practices**

- Validate and sanitize all JSON inputs to prevent injection attacks.
- Restrict use of powerful operators like `$regex` in user-provided queries.

---

## **üîÑ Steps to Complete the Lab**

### **1Ô∏è‚É£ Capture the Login Request**

- Log in as `wiener:peter` and capture the `POST /login` request in Burp Suite.
- Send the request to **Repeater**.

### **2Ô∏è‚É£ Test Basic Injection with `$ne`**

- Modify the username field:
    
    ```json
    "username": { "$ne": "" },
    "password": "peter"
    ```
    
- Send the request. A **302 Found** response confirms successful injection.

### **3Ô∏è‚É£ Use `$regex` to Match Admin**

- Refine the username field to target admin users:
    
    ```json
    "username": { "$regex": "admin.*" },
    "password": { "$ne": "" }
    ```
    
- A **302 Found** response confirms admin login.

### **4Ô∏è‚É£ Use the Admin Session Cookie**

- Copy the `Set-Cookie` header from the successful response.
- Replace your session cookie in the browser.
- Refresh the page to confirm admin access.

---

## **‚ö†Ô∏è Troubleshooting**

### **1Ô∏è‚É£ Injection Fails**

- Ensure JSON syntax is correct (e.g., properly quote field names and operators).
- Test alternative operators like `$gt`, `$lt`, or `$in` if `$ne` and `$regex` don‚Äôt work.

### **2Ô∏è‚É£ Server Errors**

- Check the application‚Äôs response for clues about input sanitization.
- Try different payload structures or encodings (e.g., double quotes, escaping).

---

## **üìö Exam Readiness**

### **1Ô∏è‚É£ Key Methodology**

- **Recon**: Determine if the app uses a NoSQL database like MongoDB.
- **Test Injection**: Use `$ne` and `$regex` to manipulate queries.
- **Confirm Login**: Look for a **302 Found** response and session cookies.

### **2Ô∏è‚É£ Next Steps**

- Practice using `$ne`, `$regex`, and other MongoDB operators.
- Study other NoSQL databases to understand their syntax and vulnerabilities.

---