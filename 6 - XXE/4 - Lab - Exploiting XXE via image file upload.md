# üßë‚Äçüíª **Lab: Exploiting XXE via Image File Upload**

## üåê **Lab URL:** https://portswigger.net/web-security/xxe/lab-xxe-via-file-upload

Exploiting XXE via Image File Upload - PortSwigger

---

## üöÄ **High-Level Summary of the Lab:**

- _**Objective:**_ Exploit an XXE vulnerability in an image file upload function to leak sensitive data.
    
- _**Vulnerability Cause:**_ Improper handling of XML external entities in an SVG file processed by the Apache Batik library.
    
- _**Key Techniques:**_
    
    - XXE through SVG file upload.
        
    - Use of _**Burp Suite**_ to intercept and modify requests.
        
- _**Key Learnings:**_
    
    - How to identify and exploit an XXE vulnerability via file uploads.
        
    - Understanding the use of the `file:///etc/hostname` payload in SVG.
        

---

## üìñ **PortSwigger Solution:**

1. Create an **SVG** file with the following content:
    

```
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]>
<svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg">
    <text font-size="16" x="0" y="16">&xxe;</text>
</svg>
```

2. Post a comment on the blog post and upload the image as an avatar.
    
3. Once submitted, view the comment and check if the image displays the server's hostname.
    
4. Submit the server hostname to solve the lab.

---

## üõ†Ô∏è **Your Solution:**

1. Open **Burp Suite** and navigate to the lab URL.
    
2. Create a test comment and upload a non-malicious image file to capture the request.
    
3. Send the captured request to **Repeater** and modify it:
    
    - Change the file extension to `.svg`.
        
    - Set the `Content-Type` header to `image/svg+xml`.
        
4. Replace the file content with the crafted XXE payload mentioned above.
    
5. Submit the modified request.
    
6. Return to the comments section and inspect the uploaded image.
    
7. Extract the displayed server hostname from the SVG image.
    
8. Submit the extracted hostname to complete the lab.
    

---

## üéì **Instructor Solution:**

1. **Initial Observation:**
    
    - The instructor starts by testing the comment and file upload functionalities.
        
    - **Key Point:** Whenever data is reflected back on the page, consider _**Cross-Site Scripting (XSS)**_ or _**JavaScript Injection**_.
        
2. **Testing Image Upload:**
    
    - Created a basic test comment with a standard image upload.
        
    - Encountered a **file size error** in **Burp Suite**.
        
    - The error message indicated the image was too large, but the request was still captured.
        
3. **Analyzing with Burp Suite:**
    
    - Sent the captured request to **Repeater**.
        
    - Cleaned the request and modified the file type to `svg+xml`.
        
    - Confirmed the use of XML by referencing **PayloadsAllTheThings**.
    - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection#xxe-inside-svg

![[Pasted image 20250105221752.png]]

        
4. **Crafting the Payload:**
    
    - Used the following XML payload in an SVG file:
        

```
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]>
<svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg">
    <text font-size="16" x="0" y="16">&xxe;</text>
</svg>
```

5. **Uploading the Payload:**
    
    - Re-uploaded the modified SVG file.
        
    - Confirmed successful upload by checking the avatar image on the blog comment.
        
6. **Extracting the Hostname:**
    
    - Inspected the rendered image and extracted the hostname displayed.
        
    - Submitted the hostname and solved the lab.
        

---

## üí° **Why This Solution is an Example of XXE:**

- _**Target:**_ File upload with image processing using Apache Batik.
    
- _**Exploitation:**_ Injected an external entity reference in an SVG file to leak `/etc/hostname`.
    
- _**Impact:**_ Successful data exfiltration from the server.
    

---

## üè∑Ô∏è **Hashtags and Tags:**

`#XXE #WebSecurity #BurpSuite #PathTraversal #PortSwigger`
