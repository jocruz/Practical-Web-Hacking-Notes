# Lab: Manipulating WebSocket messages to exploit vulnerabilities

Lab description:
This online shop has a live chat feature implemented using WebSockets.

Chat messages that you submit are viewed by a support agent in real time.

To solve the lab, use a WebSocket message to trigger an `alert()` popup in the support agent's browser


PortSwigger solution:
1. Click "Live chat" and send a chat message.
2. In Burp Proxy, go to the WebSockets history tab, and observe that the chat message has been sent via a WebSocket message.
3. Using the browser, send a new message containing a `<` character.
4. In Burp Proxy, find the corresponding WebSocket message and observe that the `<` has been HTML-encoded by the client before sending.
5. Ensure that Burp Proxy is configured to intercept WebSocket messages, then send another chat message.
6. Edit the intercepted message to contain the following payload:
    
    `<img src=1 onerror='alert(1)'>`
7. Observe that an alert is triggered in the browser. This will also happen in the support agent's browser.


Instructor solution:

Head over to the Live Chat section

We see a Live chat, we can send hello to see if it responds and it does.

Lets give it a XSS payload

```html
<img src=x onerror=prompt()>
```

Lets go over to proxy -> http history

in the http history we can see a GET request with the URL /chat

if we check that out we see that the response says 

http /1.1 101 Switching Protocol

We can swtich over to the WebScokets history 

If we look through the history we see a lot of "PING" and "PONG" which the instructor says its a heart beat to keep it alive

From there we can see some of our conversation, we continue to look through the history to find our XSS payload

Once we find it we can that the payload got encoded.

So lets do this, lets intercept out traffic and when it gets encoded, we will intercept it and then uneconded it and then send it off


So we go back to the live chat, we turn on interception

we send the following in the live chat

```html
<img src=x onerror=prompt()>
```

we see ping and pong and we just keep sending it through till we see our payload, and we find it with some encoding and we simply remove the encoding and we send it through to the lab

we return to the lab to see how it receives the xss payload and we get a completed lab because the XSS payload worked.
Observe that a prompt is triggered in the browser. This will also happen in the support agent's browser.