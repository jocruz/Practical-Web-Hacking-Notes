
---
# ðŸ§ª Lab: Manipulating WebSocket Messages to Exploit Vulnerabilities

Lab URL: [https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability](https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability)

## High-Level Summary

**Objective:** Exploit a WebSocket message vulnerability by injecting a payload to trigger an `alert()` popup in the support agent's browser.

**Key Techniques & Concepts:**

- **WebSockets:** Persistent, bi-directional communication between the client and server.
    
- **WebSocket Message Manipulation:** Intercepting and modifying WebSocket messages in Burp Suite.

- **Client-Side Validation Bypass:** HTML-encoded messages are bypassed via direct message tampering.


**What Makes This Vulnerable?**

- The WebSocket messages are being HTML-encoded only on the client side but not properly validated on the server side.

---

## PortSwigger Solution

1. **Initiate a Live Chat Session:**
    
    - Click **Live chat** and send a basic message like `Hello`.
        
2. **Observe WebSocket Traffic:**
    
    - In **Burp Suite > Proxy > WebSockets History**, observe the WebSocket message exchange.
        
3. **Test for Encoding:**
    
    - Send a message containing a `<` character and observe if it gets HTML-encoded (`&lt;`).
        
4. **Intercept and Modify WebSocket Message:**
    
    - Ensure WebSocket interception is enabled in **Burp Suite**.
        
    - Send another message containing the payload:
        
        ```
        <img src=1 onerror='alert(1)'>
        ```
        
    - Remove any encoding in the intercepted message.
        
5. **Send Modified Payload:**
    
    - Forward the modified WebSocket message.
        
    - Confirm the `alert()` box pops up both in your browser and the support agent's.
        

âœ… **Lab Completed Successfully**

---

## Instructor Solution

### Step 1: Engage the Live Chat

- Navigate to the live chat feature and send a basic message (`Hello`).
    
- Confirm the message is reflected in real-time.
    

### Step 2: Identify WebSocket Usage

- Go to **Burp Suite > Proxy > HTTP History**.
    
- Observe a `GET` request to `/chat` resulting in a `101 Switching Protocol` response, indicating a WebSocket connection.
    

### Step 3: Examine WebSocket Traffic

- Switch to the **WebSockets History** tab.
    
- Observe frequent **PING** and **PONG** messages, indicating the WebSocket heartbeat.
    

### Step 4: Send Test Payload

- Send the following XSS payload through the live chat box:
    
    ```
    <img src=x onerror=prompt()>
    ```
    
- Observe how the payload gets encoded.
    

### Step 5: Intercept and Modify Message

- Enable WebSocket interception in **Burp Suite**.
    
- Resend the same payload and intercept the WebSocket message.
    
- Remove the encoding (`&lt;` â†’ `<` and `&gt;` â†’ `>`).
    

### Step 6: Send the Modified Payload

- Forward the modified message.
    
- Observe the `alert()` popup appearing both on your screen and the support agent's screen, confirming successful exploitation.
    

âœ… **Lab Completed Successfully**

---

## Explanation of Payloads and Techniques

### **WebSockets Overview:**

- **WebSockets** allow real-time, bidirectional communication between a client and a server.
    
- Unlike HTTP requests, WebSockets maintain a persistent connection, often seen in chat applications.


### **Why the Payload Works:**

- The payload `<img src=1 onerror='alert(1)'>` works because:
    
    - It injects an image element with an invalid source.
        
    - The `onerror` event triggers JavaScript when the image fails to load.
    
- **Client-Side Encoding:**
    
    - The `<` and `>` characters were encoded as `&lt;` and `&gt;`.
    
    - By intercepting and manually removing the encoding, the payload executed successfully.
    

### **Key Indicators of Vulnerability:**

- Use of WebSockets without server-side validation.
    
- Client-side only encoding or filtering.


---

## Tools and Commands

- **Burp Suite:** WebSockets History, Proxy Interception
    
- **Payload:**

    ```
    <img src=1 onerror='alert(1)'>
    ```
    
- **Resources:** PortSwigger WebSocket Security Guide