
---
# ðŸ§ª Lab: Exploiting a Mass Assignment Vulnerability

Lab URL: [https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability](https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability)

## High-Level Summary

**Objective:** Exploit a mass assignment vulnerability to apply a full discount and purchase the **Lightweight "l33t" Leather Jacket** despite insufficient funds.

**Key Techniques & Concepts:**

- **Mass Assignment Vulnerability:** Allows modification of sensitive object properties not intended for the user to control.
    
- **API Interaction:** Reviewing both `GET` and `POST` requests to identify writable parameters.
    
- **JSON Manipulation:** Editing JSON payloads directly in Burp Suite to insert unauthorized parameters.
    

**What Makes This Vulnerable?**

- The API accepts additional parameters (`chosen_discount`) in the POST request without proper validation, leading to unauthorized discounts.
    

---

## PortSwigger Solution

1. **Log into the Lab:**
    
    - Use the provided credentials: `wiener:peter`.
        
2. **Add Product to Basket:**
    
    - Select the **Lightweight "l33t" Leather Jacket** and add it to the basket.
        
3. **Attempt Purchase:**
    
    - Go to the basket and click **Place Order**.
        
    - Observe that there is insufficient credit for the purchase.
        
4. **Capture API Requests:**
    
    - Go to **Burp Suite > Proxy > HTTP History**.
        
    - Observe both `GET` and `POST` requests for `/api/checkout`.
        
5. **Identify the Vulnerable Parameter:**
    
    - The `GET` response contains the following JSON:
        
        ```
        {
          "chosen_discount": { "percentage": 0 },
          "chosen_products": [ { "product_id": "1", "quantity": 1, "name": "Lightweight \"l33t\" Leather Jacket" } ],
          "item_price": 133700
        }
        ```
        
    - The `POST` request lacks the `chosen_discount` parameter:
        
        ```
        {
          "chosen_products": [ { "product_id": "1", "quantity": 1 } ]
        }
        ```
        
6. **Modify the POST Request:**
    
    - Send the `POST /api/checkout` request to **Repeater**.
        
    - Modify the payload to include the `chosen_discount` parameter:
        
        ```
        {
          "chosen_discount": { "percentage": 100 },
          "chosen_products": [ { "product_id": "1", "quantity": 1 } ]
        }
        ```
        
7. **Send the Modified Request:**
    
    - Send the modified request.
        
    - Verify receiving a `201 Created` response.
        
8. **Check the Lab Completion:**
    
    - Return to the lab interface and verify the lab is completed successfully.
        

---

## Instructor Solution

### Step 1: Log into the Web Application

- Use the credentials `wiener:peter`.
    
- Select the **Lightweight "l33t" Leather Jacket** and add it to the basket.
    

### Step 2: Analyze Requests in Burp Suite

- Capture the traffic using **Burp Suite**.
    
- Identify the `GET /api/checkout` request showing the `chosen_discount` parameter:
    
    ```json
    {
      "chosen_discount": { "percentage": 0 },
      "chosen_products": [ { "product_id": "1", "quantity": 1, "name": "Lightweight \"l33t\" Leather Jacket" } ],
      "item_price": 133700
    }
    ```
    

### Step 3: Modify the POST Request

- Locate the `POST /api/checkout` request:
    
    ```json
    {
      "chosen_products": [ { "product_id": "1", "quantity": 1 } ]
    }
    ```
    
- Send the `POST /api/checkout` request to **Repeater**.
    
- Add the missing `chosen_discount` parameter with a value of `100`:
    
    ```json
    {
      "chosen_discount": { "percentage": 100 },
      "chosen_products": [ { "product_id": "1", "quantity": 1 } ]
    }
    ```
    

### Step 4: Send the Request

- Submit the modified request with the discount applied.
    
- Observe a successful `201 Created` response.
    

### Step 5: Confirm Lab Completion

- Return to the web interface and confirm the lab completion message.
    

âœ… **Lab completed successfully.**

---

## Explanation of Payloads and Techniques

### **Mass Assignment Vulnerability:**

- Occurs when an API allows user-controlled parameters to modify sensitive fields without validation.
    
- In this lab, the `chosen_discount` field was accessible but not included in the initial POST request, revealing a mass assignment issue.
    

### **Why the Attack Works:**

- The server accepts additional fields from the client (`chosen_discount`) without validation.
    
- Modifying this parameter allows unauthorized discounts to be applied.
    

### **Key Indicators:**

- **GET and POST Parity:** The `GET` request included the `chosen_discount` field, but the `POST` request did not.
    
- **Direct Modification:** Adding the field manually allowed manipulation.
    

---

## Tools and Commands

- **Burp Suite:** Repeater, Proxy, JSON Manipulation
    
- **Payload:**
    
    ```
    {
      "chosen_discount": { "percentage": 100 },
      "chosen_products": [ { "product_id": "1", "quantity": 1 } ]
    }
    ```
    
- **Resources:** PortSwigger Mass Assignment