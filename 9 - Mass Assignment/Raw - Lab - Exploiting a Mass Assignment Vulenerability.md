# Lab: Exploiting a mass assignment vulnerability

URL:
https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability

To solve the lab, find and exploit a mass assignment vulnerability to buy a **Lightweight l33t Leather Jacket**. You can log in to your own account using the following credentials: `wiener:peter`.

Port swigger solution:
1. In Burp's browser, log in to the application using the credentials `wiener:peter`.
    
2. Click on the **Lightweight "l33t" Leather Jacket** product and add it to your basket.
    
3. Go to your basket and click **Place order**. Notice that you don't have enough credit for the purchase.
    
4. In **Proxy > HTTP history**, notice both the `GET` and `POST` API requests for `/api/checkout`.
    
5. Notice that the response to the `GET` request contains the same JSON structure as the `POST` request. Observe that the JSON structure in the `GET` response includes a `chosen_discount` parameter, which is not present in the `POST` request.
    
6. Right-click the `POST /api/checkout` request and select **Send to Repeater**.
    
7. In Repeater, add the `chosen_discount` parameter to the request. The JSON should look like the following:
    
    `{ "chosen_discount":{ "percentage":0 }, "chosen_products":[ { "product_id":"1", "quantity":1 } ] }`
    
8. Send the request. Notice that adding the `chosen_discount` parameter doesn't cause an error.
    
9. Change the `chosen_discount` value to the string `"x"`, then send the request. Observe that this results in an error message as the parameter value isn't a number. This may indicate that the user input is being processed.
    
10. Change the `chosen_discount` percentage to `100`, then send the request to solve the lab.

Instructor Notes to solution:

We check out the web application, we log in to the application using the credentials `wiener:peter`

from there we go to  Click on the **Lightweight "l33t" Leather Jacket** product and add it to your basket.


We then Go to your basket and click **Place order**. Notice that you don't have enough credit for the purchase.

We head over to burp suite and we check out our traffic that we captured and notice that there is a GET request with the URL /api/checkout

from there we can see that the response from the get request has json object inside and we can see that it says:

`{ "chosen_discount":{ "percentage":0 }, "chosen_products":[ { "product_id":"1", "quantity":1, "name":"lightweight \"l33t\" Leather Jacket}, "item_price":133700 ] }`

okay from here we can now find the POST request with the same /api/checkout url and we can see that it contains 

`{ "chosen_products":[ { "product_id":"1", "quantity":1 } ] }`

So what we want to do is simply add the discount code for it be 100 so we can get full price off and be able to check out with the full discont code

okay from here we add it in in the post request as so:

`{ "chosen_discount":{ "percentage":100 }, "chosen_products":[ { "product_id":"1", "quantity":1 } ] }`


So now we added more to the json object knowing that it probably accepts it from the other json object we found in the GET request.

We get 201 created if we send the request from repeater.

If we go back to the lab we get lab completed.